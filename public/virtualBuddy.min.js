function runVirtualBuddy(){let t=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,e={top:0,bottom:0,last:0,diff:0,direction:null,create:function(t,e={}){let n=p(t="string"==typeof t?document.querySelector(t):t),i=e.onEnter||null,s=e.onLeave||null,l=e.onScroll||null,a=e.inertia?.01*e.inertia:1,u=n.top<o.height?n.bottom:n.height+o.height;r.items.push({el:t,pos:n,onEnter:i,onLeave:s,onScroll:l,visible:!1,inertia:a,duration:u,progress:0,realProgress:0,entering:!1,leaving:!1,busy:!1})}},o={width:window.innerHeight,height:t?window.innerHeight+150:window.innerHeight,create:function(){}},n={create:function(t={}){t.el=t.el||"body",t.container=t.container||"html",i.el=document.querySelector(t.el),i.container=document.querySelector(t.container),i.limit=t.limit||0,i.inertia=t.inertia?.1*t.inertia:.1,a(),u()},destroy:function(){s(),i.el=null,i.container=null,i.limit=0,i.inertia=0}},i={on:!1,height:0,inertia:0,limit:0,el:null,container:null},r={busy:!1,itemsBusy:!1,functions:[],items:[]};function s(){i.on=!1,i.el.style.cssText="",i.container.style.cssText="",document.documentElement.style.overscrollBehavior="",document.body.style.overscrollBehavior=""}function l(){let t=m(e.top,window.scrollY,i.inertia);Math.abs(t-window.scrollY)<.02&&(t=window.scrollY),r.busy=t!=window.scrollY,c(t),window.requestAnimationFrame(()=>{d(),function(t,{x:e=0,y:o=0,r:n=0,s:i=1}){let r=n*(Math.PI/180),s=Math.cos(r)*i,l=Math.sin(r)*i,a=`matrix(${s},${l},${-l},${s},${e},${o})`;t.style.webkitTransform=a,t.style.msTransform=a,t.style.transform=a}(i.el,{y:-e.top}),r.busy&&l()})}function a(){o.width<i.limit&&i.on&&s(),o.width>=i.limit&&!i.on&&function(){let t=e.top;i.on=!0,i.container.style.cssText=`height:${i.el.offsetHeight}px;`,i.el.style.cssText=`position:fixed;\n                                top: ${i.el.offsetTop}px;\n                                left: 0px;\n                                right: 0px;\n                                transform: translateY(${-t}px);`,document.documentElement.style.overscrollBehavior="none",document.body.style.overscrollBehavior="none"}()}function u(){i.height=i.el.offsetHeight,i.container.style.height=i.height+"px"}function h(){r.busy||(i.on?l():(c(window.scrollY),r.busy=!0,window.requestAnimationFrame(()=>{d(),r.busy=!1,r.itemsBusy&&runItems()})))}function c(t){e.last=e.top,e.top=t,e.bottom=e.top+o.height,e.diff=e.top-e.last,e.direction=e.diff>0?"down":e.diff<0?"up":"stopped"}function d(){r.items.forEach(t=>{let o=function(t){return t.top-300<e.bottom&&t.bottom+300>e.top}(t.pos);(t.visible||o)&&(t.entering=o&&!t.visible,t.leaving=!o&&t.visible,t.visible=o,t.realProgress=1-f((t.pos.bottom-e.top)/t.duration),!t.busy&&function t(o){let n=f(m(o.progress,o.realProgress,o.inertia));o.progress=Math.abs(n-o.realProgress)<.001?o.realProgress:n;o.busy=o.progress!=o.realProgress;o.onEnter&&o.entering&&o.onEnter({...e,progress:n});o.onLeave&&o.leaving&&o.onLeave({...e,progress:n});o.onScroll&&o.visible&&o.onScroll({...e,progress:n});o.busy&&window.requestAnimationFrame(()=>t(o))}(t))})}function m(t,e,o){return(1-o)*t+o*e}function f(t,e=1,o=0){return Math.max(Math.min(t,e),o)}function p(t){let o=t.offsetWidth,n=t.offsetHeight,i=t.getBoundingClientRect(),r=function(t){let e={x:0,y:0,r:0,s:1};if(window.getComputedStyle){let o=getComputedStyle(t,null),n=(o.getPropertyValue("-webkit-transform")||o.getPropertyValue("-moz-transform")||o.getPropertyValue("-ms-transform")||o.getPropertyValue("-o-transform")||o.getPropertyValue("transform")).match(/^matrix\((.+)\)$/);if(n){let t=n[1].split(",").map(t=>parseFloat(t)),o=Math.atan2(t[1],t[0]),i=Math.pow(t[0],2)+Math.pow(t[1],2),r=Math.sqrt(i),s=(t[0]*t[3]-t[2]*t[1])/r;Math.atan2(t[0]*t[2]+t[1]*t[3],i),e.x=t[4],e.y=t[5],e.r=o/(Math.PI/180),e.s=s}}return e}(t),s=function(t=0,e=0,o=0,n=1,i=0,r=0){let s=i*n,l=r*n,a=(r-l)/2,u=(i-s)/2,h=0,c=0;if(0!==o){let t=o*Math.PI/180,e=Math.cos(t),n=Math.sin(t),i=0,r=0,a=l/2,u=s/2,d=[[(i-=a)*e-(r-=u)*n+a,i*n+r*e+u],[(i+l)*e-r*n+a,(i+l)*n+r*e+u],[(i+l)*e-(r+s)*n+a,(i+l)*n+(r+s)*e+u],[i*e-(r+s)*n+a,i*n+(r+s)*e+u]];h=Math.max(d[0][0],d[1][0],d[2][0],d[3][0])-l,c=Math.max(d[0][1],d[1][1],d[2][1],d[3][1])-s}return{x:t,y:e,rx:h,ry:c,sx:a,sy:u}}(r.x,r.y,r.r,r.s,n,o),l={};return l.height=n,l.width=o,l.top=e.top+i.top-s.y+s.ry-s.sy,l.left=i.left-s.x+s.rx-s.sy,l.bottom=l.top+l.height,l.right=l.left+l.width,l}window.virtualbuddy={scroll:e,resize:o,mouse:{x:0,y:0},smooth:n},window.addEventListener("scroll",h),window.addEventListener("resize",function(){if(t&&o.width===window.innerWidth)return;(function(){o.height=window.innerHeight,o.width=window.innerWidth,i.on&&u();i.limit&&a();r.items.forEach(t=>{t.pos=p(t.el),t.duration=t.pos.top<o.height?t.pos.bottom:t.pos.height+o.height})})(),h()}),window.addEventListener("mousemove",function(){})}runVirtualBuddy();
